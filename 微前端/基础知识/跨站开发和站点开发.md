# 跨站开发

跨站开发其实是一个容易混淆的词，在前端圈里经常被提到，但真正指的是两种完全不同的概念：

1. 跨站脚本攻击（Cross-Site Scripting，缩写 XSS）—— 安全漏洞（大多数人说的“跨站”其实指这个）
2. 跨域资源开发（Cross-Origin Development）—— 开发中遇到的跨域问题（真正的前端开发痛点）

下面我详细拆分讲解这两个概念，因为它们都常被简称为“跨站开发”。

### 一、跨站脚本攻击（XSS）—— 安全问题

XSS 是最常见的前端安全漏洞之一，OWASP Top 10 常年排名前三。

#### 1. 三种主要类型

| 类型          | 触发时机           | 是否需要存储到服务器 | 典型场景                                 | 危害程度 |
|---------------|--------------------|----------------------|------------------------------------------|----------|
| 反射型 XSS   | 用户点击恶意链接时 | 不需要               | 搜索框回显、错误页面参数                 | 中等     |
| 存储型 XSS   | 页面加载时自动执行 | 需要（存到数据库）   | 评论区、论坛帖子、个人信息昵称           | 最高     |
| DOM Based XSS | 纯前端 JavaScript 操作 DOM | 不需要           | 使用 innerHTML、location.hash、eval 等   | 高       |

#### 2. 经典攻击示例

```js
// 存储型 XSS 示例（用户在评论里输入）
<script>alert('你被攻击了')</script>

// 反射型 XSS 示例（URL 参数）
https://example.com/search?q=<script>alert(document.cookie)</script>

// DOM Based XSS 示例
const name = location.hash.slice(1);
document.getElementById('welcome').innerHTML = 'Hello ' + name;
// 用户访问：https://example.com/#<img src=x onerror=alert(1)>
```

#### 3. 防御手段（前端必做）

| 防御方式               | 具体做法                                                                 | 推荐工具/方案                     |
|-----------------------|--------------------------------------------------------------------------|-----------------------------------|
| 输入校验              | 前端 + 后端都要做白名单校验                                              | 正则、schema 校验                 |
| 输出编码              | 根据上下文进行不同编码                                                   |                                   |
|                       | HTML 实体编码：& → &amp;   < → &lt;                                     | Vue/React 自动做，手动用 he/escape |
|                       | JavaScript 编码：使用 JSON.stringify 或编码引号                         |                                   |
|                       | URL 编码：encodeURIComponent                                             |                                   |
| 使用 CSP              | Content-Security-Policy 响应头，禁止内联脚本和 eval                     | CSP Evaluator 在线检查            |
| HttpOnly Cookie      | 重要 Cookie 设置 HttpOnly，JS 无法读取 document.cookie                  | 后端设置                          |
| 使用安全富文本编辑器  | 禁止 script、onerror 等标签和属性                                        | DOMPurify、wangeditor + purify    |

推荐库：
```bash
npm install dompurify   # 清洗 HTML
npm install xss         # 过滤
```

### 二、跨域资源开发（Cross-Origin）—— 开发中的跨域问题

这是前端开发中最常见的“跨站”问题，正式叫法是 **同源策略（Same-Origin Policy）** 限制。

#### 1. 什么是同源？

协议 + 域名 + 端口 完全一致才算同源

| URL                                      | 与 https://www.example.com:443 是否同源 | 原因不同部分       |
|------------------------------------------|----------------------------------------|--------------------|
| https://www.example.com/about            | 同源                                   | 路径不同没事       |
| http://www.example.com                   | 不同源                                 | 协议不同           |
| https://api.example.com                  | 不同源                                 | 子域名不同         |
| https://www.example.com:8080             | 不同源                                 | 端口不同           |

#### 2. 常见的跨域场景

- 前端：https://www.a.com
- 后端 API：https://api.a.com 或 https://b.com
- 开发本地：http://localhost:3000 → https://api.a.com

#### 3. 9 种跨域解决方案

| 方案                  | 是否推荐 | 适用场景                        | 优缺点                                                                 |
|-----------------------|----------|---------------------------------|------------------------------------------------------------------------|
| CORS（推荐首选）      | ★★★★★    | 生产环境                        | 后端加几个 header 就行，最规范安全，支持所有请求类型                  |
| JSONP（已过时）       | ★☆☆☆☆    | 只支持 GET，老项目              | 不安全，已被废弃                                                       |
| nginx 反向代理        | ★★★★★    | 同服务器部署，前后端分离        | 开发生产都好用，零代码改动                                             |
| postMessage           | ★★★★☆    | iframe、窗口间通信              | 安全，但只适合特定场景                                                 |
| WebSocket             | ★★★★☆    | 实时通信                        | 协议是 ws://，不受同源策略限制                                         |
| proxy（开发时）       | ★★★★★    | Vite/Create-React-App 开发阶段  | 开发必备，vite.config.js / setupProxy.js 配置即可                      |
| Nginx subdomain proxy | ★★★★☆    | 子域名跨域                      | 把 api.a.com 代理到 www.a.com 同源                                     |
| document.domain       | ★☆☆☆☆    | 主域相同，子域不同（已废弃）    | 现代浏览器基本不支持                                                   |
| next.js/nuxt rewrite  | ★★★★★    | Next.js/Nuxt 项目               | 内置 API routes 或 rewrites 完美解决                                   |

#### 4. 最常用 CORS 配置示例

后端（Node.js Express）：
```js
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', 'https://www.a.com'); // 或 '*'
  res.header('Access-Control-Allow-Credentials', 'true'); // 允许带 cookie
  res.header('Access-Control-Allow-Methods', 'GET,POST,PUT,DELETE,OPTIONS');
  res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization');
  if (req.method === 'OPTIONS') {
    res.sendStatus(200);
  } else {
    next();
  }
});
```

开发阶段 Vite 配置（vite.config.ts）：
```ts
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'https://api.example.com',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  }
})
```

### 总结：你问的“跨站开发”到底是哪个？

- 如果你在面试或安全审查中被问 → 99% 是指 **XSS 跨站脚本攻击**
- 如果你在日常开发中遇到跨域报错 → 是指 **跨域资源共享（CORS）问题**

两者都非常重要，前端工程师必须同时掌握！

# 跨站开发和站点开发

“跨站开发”和“站点开发”这两个词在前端圈经常被提到，但其实是两个完全不同的概念，容易混淆。下面用最清晰的方式帮你彻底区分它们：

| 对比维度         | 跨站开发（Cross-Site Development）                          | 站点开发（Site Development / Single-Site Development）      |
|------------------|-------------------------------------------------------------|-------------------------------------------------------------|
| 核心关注点       | 多个域名、多个源（origin）之间的协作与安全                   | 只在一个域名（一个源）下开发和运行                         |
| 典型场景         | 前端 www.a.com，后端 api.a.com 或 api.b.com                  | 前端 + 后端全部部署在同一个域名下（如 www.example.com）     |
| 是否涉及跨域     | 一定会遇到跨域（CORS）                                      | 完全不会出现跨域问题                                       |
| 常见技术难点     | CORS 配置、Cookie 跨域、XSS/CSRF 防御、子域共享             | 基本没有跨域相关问题，难点集中在架构、性能、SEO 上         |
| 部署方式         | 前后端分离（最常见）                                         | 前后端一体化（如 Next.js SSR、Nuxt、传统 PHP、Java SSM）   |
| 开发阶段解决方式 | Vite/Webpack 代理（devServer.proxy）                        | 直接本地访问 localhost:3000 即可                           |
| 生产环境解决方式 | 1. CORS 头<br>2. Nginx 反向代理（最常见）<br>3. BFF 层     | 不需要任何跨域处理                                         |
| 安全性差异       | 必须严格防 XSS、CSRF、注意 Cookie 域和 SameSite             | 相对简单，CSRF 风险更低                                    |
| 代表项目类型     | React + Node、Vue + Spring Boot、微前端、第三方登录         | 传统企业站、WordPress、Next.js 全站 SSR、博客、营销页      |
| 主流趋势  | 90% 以上新项目都是跨站开发（前后端分离）                     | 只在需要极致 SEO、传统项目、个人小站时使用                 |

### 举个最直观的例子对比

| 项目类型         | 域名情况                              | 是否跨站开发 | 开发时会看到什么错误                              |
|------------------|---------------------------------------|--------------|---------------------------------------------------|
| 跨站开发（主流） | 前端：https://www.taobao.com<br>后端：https://api.taobao.com | 是           | No 'Access-Control-Allow-Origin' header           |
| 站点开发         | 所有页面和接口都在 https://myblog.com | 否           | 完全没有跨域报错                                  |

### 快速判断你现在做的是哪一种？

问自己两个问题：
1. 你的前端静态资源和后端 API 接口是同一个域名吗？
   - 是 → 站点开发（单站点）
   - 不是 → 跨站开发（跨域开发）

2. 打包后的 dist 文件夹是直接扔到后端服务器，还是扔到 CDN/Nginx 独立部署？
   - 独立部署（CDN）→ 跨站开发
   - 扔到后端服务器和代码放一起 → 站点开发

### 总结一句话区别（适合面试直接说）

- **跨站开发** = 前后端分离部署，必然涉及跨域（CORS）问题，现代前端主流模式。
- **站点开发** = 前后端同域部署（或服务端渲染），完全没有跨域问题，传统全栈模式。

现在，95% 的前端岗位要求的是“跨站开发”能力（熟练解决跨域 + 防 XSS），只有做营销页、传统后台、或 Next.js/Nuxt 全站渲染时才会用到纯“站点开发”。