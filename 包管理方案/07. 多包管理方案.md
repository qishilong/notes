# 多包管理方案

思考🤔：什么是包？

答案：被包管理器（npm、yarn、pnpm）初始化之后的目录，会存在一个包描述文件package.json，那么这样的目录就被称之为包。

思考🤔：什么是仓库？

答案：被版本控制系统（svn、git）初始化之后的目录，例如使用 git 进行初始化之后，会存在一个 .git 的目录。

在多包管理上面，常见的方案就是两种：

- 多仓管理（Multirepo）：一个包对应一个仓库，多个包对应多个仓库
- 单仓管理（Monorepo）：无论是一个包还是多个包，都对应**一个仓库**

<img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2024-08-21-072734.png" alt="image-20240821152734279" style="zoom:50%;" />

## Monorepo

一个仓库一个项目的管理方式的弊端：

- 每个项目都要搭建 eslint + prettier + commitLint + styleLint 等代码规范校验
- 每个项目都要搭建许多类似的常用组件和创建公共 utils 函数
- 各个项目的主要依赖库（vue、elementPlus）版本可能不一致，且存在重复安装
- 有时候组件改动会涉及到多个项目都要手动更改

 Monorepo 可以让多个模块共享同一个仓库，因此他们可以共享同一套构建流程、代码规范也可以做到统一，特别是如果存在模块间有**共享**公共组件的情况，查看代码、修改 bug、调试等会更加方便。

1. 统一的依赖管理
2. 简化代码共享
3. 更容易进行跨项目更改
4. 更好的跨团队协作

**知名公司使用Monorepo案例**

- 谷歌（Google）：谷歌是使用 Monorepo 的著名代表之一。他们将所有项目和库存储在一个称为 Piper 的庞大代码库中。这使得他们能够更容易地管理依赖关系、共享代码并跨项目进行更改。

- Meta：Meta 也采用了 Monorepo 策略。他们的代码库包括了多个项目，如 React、React Native 和 Jest 等。这有助于他们统一管理这些项目的代码和依赖关系。

- 微软（Microsoft）：虽然微软在某些方面使用多代码库策略，但在一些项目中也采用的 Monorepo 仓库策略。例如，Windows 操作系统和 Visual Studio 代码编辑器都使用 Monorepo 进行管理。

- Twitter：Twitter 也是 Monorepo 的支持者，他们将所有代码存储在一个称为 Pants 的代码库中。这有助于他们更好地管理依赖关系和提高代码复用率。

- Uber：Uber 使用一个名为 Fusion.js 的 Monorepo 代码库来管理他们的许多前端项目。这使他们能够更有效地共享代码和跨项目进行更改。

很多知名的前端项目也采用 Monorepo 的方式来管理多个包的。

**企业开发中使用Monorepo**

在企业开发中，如果你选择使用 Monorepo 来架构你的多个项目，那么通常是将公共的组件、工具库、api 等抽离出来进行共享，如下图所示：

<img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2024-08-21-135139.jpg" alt="16853443595538" style="zoom:50%;" />

**Monorepo缺点**

- 代码库规模较大

- 缺乏独立版本控制

- 权限和安全性问题

- 工具和基础设施要求

思考🤔：什么时候使用 Monorepo 搭建工程比较合适？

答案：

1. 项目之间有很多共享代码和资源的时候
2. 当团队需要进行跨项目协作的时候
3. 统一多个包的依赖非常重要的时候

## Multirepo

所谓 Multirepo，就是不同项目和库存储在各自独立的代码库中的策略。

Multirepo 优点如下：

- 独立版本控制

- 更小的代码库规模

- 更高的项目自治

下表是两种代码管理策略的各方面对比：

|          | Monorepo                                                     | Multirepo                                                |
| -------- | ------------------------------------------------------------ | -------------------------------------------------------- |
| 开发     | 只需要在一个仓库中开发                                       | 仓库体积小，模块划分清晰                                 |
| 复用     | 代码复用高，方便进行代码重构                                 | 需要多个仓库来回切换，无法实现跨项目代码复用             |
| 工程配置 | 所有项目统一使用相同配置                                     | 各个项目可能有一套单独标准                               |
| 依赖管理 | 共同依赖可提升至root，版本控制更加容易，依赖管理更加方便     | 不同项目中会存在相同的依赖，并且依赖会存在版本不同的情况 |
| 代码管理 | 代码全在一个仓库，项目太大用 git 管理会存在问题，无法隔离项目代码权限 | 各个团队可以控制代码权限，也几乎不会有项目太大的问题     |

---

-EOF-